1. Cr√©er le certificat auto-sign√©

Par exemple avec ton hostname ou ton IP :

New-SelfSignedCertificate `
   -DnsName "10.179.143.43" `
   -CertStoreLocation "Cert:\LocalMachine\My" `
   -FriendlyName "ZCentricAgentCert"


üëâ Ici :

DnsName ‚Üí mets l‚ÄôIP ou le hostname de ta VM agent.

CertStoreLocation ‚Üí "Cert:\LocalMachine\My" signifie qu‚Äôil sera cr√©√© dans le magasin "Personnel" de la machine.

FriendlyName ‚Üí juste un nom pratique pour l‚Äôidentifier.


2. Exporter le certificat avec cl√© priv√©e (format .pfx)

Il faut un mot de passe pour prot√©ger la cl√© priv√©e. Exemple :

$pwd = ConvertTo-SecureString -String "ChangeMe123!" -Force -AsPlainText
Export-PfxCertificate `
   -Cert "Cert:\LocalMachine\My\ZCentricAgentCert" `
   -FilePath "C:\Users\ngahmgono_a\Desktop\sslfolder\zcentric.pfx" `
   -Password $pwd


3. Exporter le certificat sans cl√© priv√©e (format .cer)

C‚Äôest celui que tu pourras mettre dans le Trusted Root :

Export-Certificate `
   -Cert "Cert:\LocalMachine\My\ZCentricAgentCert" `
   -FilePath "C:\Users\ngahmgono_a\Desktop\sslfolder\zcentric.cer"


4. Importer le certificat public dans les Trusted Root (si n√©cessaire)
Import-Certificate `
   -FilePath "C:\Users\ngahmgono_a\Desktop\sslfolder\zcentric.cer" `
   -CertStoreLocation "Cert:\LocalMachine\Root"


**************************************************************************************************************************************************

$dns="10.179.143.43"; `
$dest="C:\Users\ngahmgono_a\Desktop\New_folder\sslfolder"; `
$pwd=ConvertTo-SecureString "ChangeMe123!" -AsPlainText -Force; `
$cert=New-SelfSignedCertificate -DnsName $dns -CertStoreLocation Cert:\LocalMachine\My -KeyExportPolicy Exportable -KeyLength 2048 -KeyAlgorithm RSA -SignatureAlgorithm sha256; `
Export-PfxCertificate -Cert ("Cert:\LocalMachine\My\{0}" -f $cert.Thumbprint) -FilePath (Join-Path $dest "zcentric.pfx") -Password $pwd | Out-Null; `
Export-Certificate -Cert ("Cert:\LocalMachine\My\{0}" -f $cert.Thumbprint) -FilePath (Join-Path $dest "zcentric.cer") | Out-Null; `
Import-Certificate -FilePath (Join-Path $dest "zcentric.cer") -CertStoreLocation Cert:\LocalMachine\Root | Out-Null; `
Write-Host "OK ‚Äî Certificat cr√©√©. Empreinte : $($cert.Thumbprint) ‚Äî Fichiers disponibles dans $dest"



Explication rapide :

$dns ‚Üí mets ici soit l‚ÄôIP de ton agent (10.179.143.43), soit son hostname.

$dest ‚Üí le dossier o√π seront d√©pos√©s les fichiers .pfx et .cer. Il doit exister avant.

$pwd ‚Üí mot de passe du certificat (ici ChangeMe123!). C‚Äôest ce mot de passe qu‚Äôil faudra passer √† l‚Äôinstalleur (-sslpassword).

zcentric.pfx = contient la cl√© priv√©e (prot√©g√©e par mot de passe).

zcentric.cer = contient la cl√© publique (ajout√©e dans le store racine).


V√©rification apr√®s coup :

Tu peux v√©rifier que ton certificat est bien cr√©√© avec :

certutil -p "ChangeMe123!" -dump (Join-Path $dest "zcentric.pfx")

**************************************************************************************************************************************


